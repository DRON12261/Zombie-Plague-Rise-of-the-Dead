/* Plugin generated by AMXX-Studio */

#include <amxmodx>
#include <zombieplague>
#include <fakemeta>

#define PLUGIN "[ZP]Infection lighting"
#define VERSION "0.1"
#define AUTHOR "Barney"

new cvar_lights,cvar_delay,bool:g_can
public plugin_init() {
	register_plugin(PLUGIN, VERSION, AUTHOR)
	cvar_lights = register_cvar("zp_lighting", "b")
	cvar_delay = register_cvar("zp_infectionlighting_delay","3.0")
	register_logevent("logEventRoundStart", 2, "1=Round_Start")
}

public logEventRoundStart() g_can = true

public zp_user_infected_pre(id){
	if(g_can){
	thunder()
	g_can = false
	set_task(get_pcvar_float(cvar_delay),"can")
	}
}

public can() g_can = true

public thunder()
{
	engfunc(EngFunc_LightStyle, 0, "v")
	client_cmd(0,"speak ambience/thunder_clap.wav")
	set_task(1.0,"lightning")
}
public lightning()
{
	static light[2]
	get_pcvar_string(cvar_lights, light, 1)
	engfunc(EngFunc_LightStyle, 0, light)
}
